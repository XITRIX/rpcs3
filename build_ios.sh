#!/bin/bash

export LLVM_DIR="/opt/homebrew/opt/llvm@19"

cmake \
    -Bbuild-ios \
    -DUSE_SDL=ON \
    -DUSE_DISCORD_RPC=OFF \
    -DUSE_VULKAN=ON \
    -DUSE_ALSA=OFF \
    -DUSE_PULSE=OFF \
    -DUSE_AUDIOUNIT=ON \
    -DWITH_LLVM=ON \
    -DLLVM_CCACHE_BUILD=OFF \
    -DLLVM_BUILD_RUNTIME=OFF \
    -DLLVM_BUILD_TOOLS=OFF \
    -DLLVM_INCLUDE_DOCS=OFF \
    -DLLVM_INCLUDE_EXAMPLES=OFF \
    -DLLVM_INCLUDE_TESTS=OFF \
    -DLLVM_INCLUDE_TOOLS=OFF \
    -DLLVM_INCLUDE_UTILS=OFF \
    -DLLVM_USE_PERF=OFF \
    -DLLVM_ENABLE_Z3_SOLVER=OFF \
    -DUSE_NATIVE_INSTRUCTIONS=OFF \
    -DUSE_SYSTEM_FFMPEG=OFF \
    -DUSE_SYSTEM_MVK=OFF \
    -DUSE_SYSTEM_FAUDIO=OFF \
    -DUSE_SYSTEM_SDL=OFF \
    -DUSE_SYSTEM_OPENCV=OFF \
    -DUSE_SYSTEM_OPENCV=OFF \
    -DUSE_SYSTEM_FAUDIO=OFF \
    -DUSE_SYSTEM_CURL=OFF \
    -DUSE_FAUDIO=ON \
    -DBUILD_LLVM=OFF \
    $CMAKE_EXTRA_OPTS \
    -DLLVM_TARGET_ARCH=arm64 \
    -DCMAKE_OSX_ARCHITECTURES=arm64 \
    -DCMAKE_IGNORE_PATH="$BREW_X64_PATH/lib" \
    -DCMAKE_IGNORE_PREFIX_PATH=/usr/local/opt \
    -DCMAKE_SYSTEM_PROCESSOR=arm64 \
    -DCMAKE_TOOLCHAIN_FILE=buildfiles/cmake/ios.toolchain.cmake \
    -DSDL_DISABLE_IMMINTRIN_H=ON \
    -DPLATFORM=OS64 \
    -DCMAKE_CXX_FLAGS="-D__MAC_OS_X_VERSION_MIN_REQUIRED=130000" \
    -G Xcode
